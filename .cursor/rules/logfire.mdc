---
description: Logfire logs –ª–æ–≥–∏
globs:
alwaysApply: false
---
1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ `start_timestamp` –≤–º–µ—Å—Ç–æ `timestamp`
   - –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (—á–∏—Å–ª–æ–≤—ã–µ):
     - error = 17
     - warn = 13
     - info = 9
     - debug = 5
     - trace = 3

2. –ê–Ω–∞–ª–∏–∑ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö:
   - –í—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞—Ç—å –ø–æ–ª–Ω—ã–π exception traceback –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (–∏ –¥–ª—è error, –∏ –¥–ª—è warning)
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ –ø–æ–ª—è:
     - exception.type - —Ç–∏–ø –∏—Å–∫–ª—é—á–µ–Ω–∏—è
     - exception.message - —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
     - exception.stacktrace - –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫—Ç—Ä–µ–π—Å
     - code.filepath - –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
     - code.function - –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏
     - code.lineno - –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏
   - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–µ–ø–æ—á–∫—É –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ—Ä–Ω–µ–≤–æ–π –ø—Ä–∏—á–∏–Ω—ã
   - –£—á–∏—Ç—ã–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –æ—à–∏–±–∫—É
   - –ü—Ä–∏ –Ω–µ—è—Å–Ω–æ–π –ø—Ä–∏—á–∏–Ω–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏ –∑–∞ –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –ø–µ—Ä–∏–æ–¥
   - –ù–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å warning –ª–æ–≥–∏ - –æ–Ω–∏ –º–æ–≥—É—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã


3. –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ Logfire:
   - –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, –ø—Ä–∏—Ö–æ–¥—è—â–∏—Ö –æ—Ç Telegram, —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–æ–ª–µ `attributes->>'update'`
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ: `attributes->'update'->'message'->'chat'`
   - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ: `attributes->'update'->'message'->'from'`
   - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è: `attributes->'update'->'message'->>'text'`
   - –î–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ø–æ –¥–Ω—è–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `DATE_TRUNC('day', start_timestamp)`

4. –ü—Ä–∏–º–µ—Ä—ã SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è Logfire:
   ```sql
   -- –ü–æ–¥—Å—á–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ –¥–Ω—è–º
   SELECT
     DATE_TRUNC('day', start_timestamp) as day,
     COUNT(*) as total_records,
     COUNT(DISTINCT attributes->'update'->'message'->'chat'->>'id') as unique_chats,
     COUNT(DISTINCT attributes->'update'->'message'->'from'->>'id') as unique_users
   FROM records
   WHERE start_timestamp >= '2025-04-07'
     AND attributes->>'update' IS NOT NULL
   GROUP BY DATE_TRUNC('day', start_timestamp)
   ```

5. –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏:
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ `attributes->>'update'` —á–µ—Ä–µ–∑ IS NOT NULL
   - –£—á–∏—Ç—ã–≤–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ->>'field' –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞, ->'field' –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤
   - –ü—Ä–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —É—á–∏—Ç—ã–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å NULL –∑–Ω–∞—á–µ–Ω–∏–π –≤ –ø–æ–ª—è—Ö

6. –¢–∏–ø–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª—É—á–∞–µ–º–æ–≥–æ –∞–ø–¥–µ–π—Ç–∞:
{'update_id': 726082068, 'message': {'message_id': 12132, 'from': {'id': 7856711520, 'is_bot': False, 'first_name': '–í–∏–∫—Ç–æ—Ä–∏—è | –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –Ω–∞ –Æ–≥–µ –†–æ—Å—Å–∏–∏', 'is_premium': True}, 'chat': {'id': -1001660382870, 'title': 'Chat –ü–∞–≤–µ–ª –ë–æ—Ä–æ–≤–∏–∫–æ–≤', 'type': 'supergroup'}, 'date': 1747396952, 'message_thread_id': 12126, 'reply_to_message': {'message_id': 12126, 'from': {'id': 777000, 'is_bot': False, 'first_name': 'Telegram'}, 'sender_chat': {'id': -1001406194622, 'title': '–ü–∞–≤–µ–ª –ë–æ—Ä–æ–≤–∏–∫–æ–≤', 'username': 'pborovikov', 'type': 'channel'}, 'chat': {'id': -1001660382870, 'title': 'Chat –ü–∞–≤–µ–ª –ë–æ—Ä–æ–≤–∏–∫–æ–≤', 'type': 'supergroup'}, 'date': 1747396858, 'forward_origin': {'type': 'channel', 'chat': {'id': -1001406194622, 'title': '–ü–∞–≤–µ–ª –ë–æ—Ä–æ–≤–∏–∫–æ–≤', 'username': 'pborovikov', 'type': 'channel'}, 'message_id': 3745, 'date': 1747396855}, 'is_automatic_forward': True, 'forward_from_chat': {'id': -1001406194622, 'title': '–ü–∞–≤–µ–ª –ë–æ—Ä–æ–≤–∏–∫–æ–≤', 'username': 'pborovikov', 'type': 'channel'}, 'forward_from_message_id': 3745, 'forward_date': 1747396855, 'video': {'duration': 23, 'width': 464, 'height': 848, 'file_name': 'IMG_0089.MP4', 'mime_type': 'video/mp4', 'thumbnail': {'file_id': 'AAMCAgADHQJi926WAAIvXmgnKPpNiMU5baBN2udP_LJ5-uktAAIscgAC4TM5SYpxezkGsI2pAQAHbQADNgQ', 'file_unique_id': 'AQADLHIAAuEzOUly', 'file_size': 10562, 'width': 175, 'height': 320}, 'thumb': {'file_id': 'AAMCAgADHQJi926WAAIvXmgnKPpNiMU5baBN2udP_LJ5-uktAAIscgAC4TM5SYpxezkGsI2pAQAHbQADNgQ', 'file_unique_id': 'AQADLHIAAuEzOUly', 'file_size': 10562, 'width': 175, 'height': 320}, 'file_id': 'BAACAgIAAx0CYvdulgACL15oJyj6TYjFOW2gTdrnT_yyefrpLQACLHIAAuEzOUmKcXs5BrCNqTYE', 'file_unique_id': 'AgADLHIAAuEzOUk', 'file_size': 4412379}, 'caption': '''–í–µ—Å–Ω–∞ - –≤—Ä–µ–º—è –∑–∞–≥–æ—Ä–æ–¥–∫–∏

–î–∞–≤–Ω–µ–Ω—å–∫–æ –Ω–µ –ø—É–±–ª–∏–∫–æ–≤–∞–ª –Ω–∏–∫–∞–∫–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –∫–æ—Ç—Ç–µ–¥–∂–µ–π, –∞ –æ–Ω–∏ –µ—Å—Ç—å —É –Ω–∞—Å. –ï—Å—Ç—å –∑–∞ 350.000.000‚ÇΩ, –∞ –µ—Å—Ç—å –∏ –∑–∞ 24.500.000‚ÇΩ, –∫–∞–∫ —ç—Ç–æ—Ç –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–º–∏ –≥–∏–≥–∞–Ω—Ç—Å–∫–∏–º–∏ –æ–∫–Ω–∞–º–∏, –≤—ã—Å–æ—Ç–æ–π 6 –º–µ—Ç—Ä–æ–≤ –∏ –ø—Ä–æ—Å—Ç–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ–π –≤–∞–Ω–Ω–æ–π –∫–æ–º–Ω–∞—Ç–æ–π, –ø–ª–æ—â–∞–¥—å—é 22 –º2 (—Å–µ–π—á–∞—Å —Å—Ç—É–¥–∏–∏ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –º–µ–Ω—å—à–µ–π –ø–ª–æ—â–∞–¥—å—é).

–û–¥–Ω–∏–º —Å–ª–æ–≤–æ–º, –µ—Å–ª–∏ –±—ã —è –∏—Å–∫–∞–ª —Å–µ–±–µ –∑–∞–≥–æ—Ä–æ–¥–Ω—ã–π –¥–æ–º, —Ç–æ, –ø–æ–∂–∞–ª—É–π –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π''', 'caption_entities': [{'offset': 131, 'length': 12, 'type': 'text_link', 'url': 'https://kuligovskaya.ru/catalog/zagorodnaya-nedvizhimost/zhizn-v-novom-svete-dom-s-panoramnymi-oknami/'}]}, 'text': '–ö–∞–∫–æ–π –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä! üåø'}}
