---
alwaysApply: true
---

# О проекте

Антиспам-бот для Telegram-групп и каналов. Автоматически определяет и удаляет спам с помощью LLM,
уведомляет администраторов, ведёт биллинг через Telegram-звёзды.
Поддерживает гибкую модерацию, статистику, исключения для админов и сервисных сообщений.
Подробнее — см. PRD.md.

# .env

В .env хранятся все необходимые пароли, токены и настройки окружения.
Тебе запрещен доступ к .env политиками безопасности.
Но ты можешь использовать команду `source .env` для загрузки переменных окружения в текущую сессию.

# Работа с серверами

Работа с серверами:
1. На локальной машине НЕТ доступа к PostgreSQL и другим сервисам, для доступа к ним надо залогиниться на удаленный сервер
2. Все команды к базе данных выполнять через SSH на удаленном сервере
3. Данные для подключения:
   - Хост: 94.250.254.232
   - Пользователь: root
   - База данных: ai_spam_bot
   - Пользователь БД: postgres

# Правила трекинга в Mixpanel

1. Все события в Mixpanel должны использовать ID администратора (admin_id) в качестве основного идентификатора.
2. Для событий, связанных с группой, group_id и другие параметры группы должны быть свойствами события, а не идентификатором.
3. Денежные транзакции дублируются в базе данных, все остальные события хранятся только в Mixpanel.

# Трекинг ошибок

- Все ошибки и предупреждения логируются через logfire с полным exception traceback
- Для logger.warning всегда добавлять exc_info=True при наличии исключения
- События отправляются в Mixpanel
- Критические ошибки отправляются в админский чат
- Группировать похожие ошибки для анализа трендов
- Отслеживать частоту повторения ошибок

# Форматирование сообщений телеграм-бота

- HTML режим: Экранировать специальные символы (<, >, &, ")
- MarkdownV2 режим: Экранировать символы (_, *, `, [, ], (, ), ~, >, #, +, -, =, |, {, }, ., !)
- Максимальная длина сообщения: 4096 символов
- Максимальная длина подписи: 1024 символа
- Максимальная длина текста кнопки: 64 символа
