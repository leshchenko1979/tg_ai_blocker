import pytest
from aiogram import Dispatcher
from aiogram.types import Message

from app.handlers.updates_filter import filter_handle_message

dp = Dispatcher()


@pytest.mark.asyncio
@pytest.mark.parametrize(
    "update, should_process",
    [
        (
            {
                "message": {
                    "chat": {
                        "id": -1001503592176,
                        "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å ‚Äî —á–∞—Ç",
                        "type": "supergroup",
                        "username": "redevest_chat",
                    },
                    "date": 1730712821,
                    "from": {
                        "first_name": "Denis",
                        "id": 205980892,
                        "is_bot": False,
                        "username": "buloshnikov",
                    },
                    "message_id": 10242,
                    "message_thread_id": 10229,
                    "reply_to_message": {
                        "caption": "üèó –ê–ø–¥–µ–π—Ç –ø–æ —Å–∫–ª–∞–¥–∞–º –≤–æ –§—Ä—è–∑–∏–Ω–æ: –¥–µ–ª–æ –∫ —Ñ–∏–Ω–∏—à—É!\n\n–î—Ä—É–∑—å—è, —Å–ø–µ—à—É –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–º–∏ –Ω–æ–≤–æ—Å—Ç—è–º–∏ —Å –Ω–∞—à–µ–π —Å—Ç—Ä–æ–π–ø–ª–æ—â–∞–¥–∫–∏!\n\n‚ñ´Ô∏è –ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –¥–æ–±—å—ë–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ñ–∏–ª—å–º –æ –ø—Ä–æ–µ–∫—Ç–µ (—Ç—Ä–µ–π–ª–µ—Ä –≤–≤–µ—Ä—Ö—É) ‚Äî –º–æ–Ω—Ç–∞–∂ —É–∂–µ –Ω–∞ —Ñ–∏–Ω–∏—à–Ω–æ–π –ø—Ä—è–º–æ–π. –ì–æ—Ç–æ–≤—å—Ç–µ –ø–æ–ø–∫–æ—Ä–Ω! üé¨\n\n‚ñ´Ô∏è –ü–µ—Ä–≤—ã–π —Å–∫–ª–∞–¥ —É–∂–µ –≥–æ—Ç–æ–≤ ‚Äî –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ–∂–¥–∞—Ç—å—Å—è, –ø–æ–∫–∞ –≤—ã—Å–æ—Ö–Ω–µ—Ç —Å–≤–µ–∂–µ–∑–∞–ª–∏—Ç—ã–π –ø–æ–ª, –∏ –º–æ–∂–Ω–æ –≤—ã—Ö–æ–¥–∏—Ç—å –Ω–∞ –∫–æ–º–∏—Å—Å–∏—é –ø–æ –≤–≤–æ–¥—É –≤ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é. –≠—Ç–æ –∫–∞–∫ –∂–¥–∞—Ç—å, –ø–æ–∫–∞ –æ—Å—Ç—ã–Ω–µ—Ç —Å–≤–µ–∂–µ–∏—Å–ø–µ—á–µ–Ω–Ω—ã–π –ø–∏—Ä–æ–≥ ‚Äî –∑–Ω–∞–µ—à—å, —á—Ç–æ –≤–æ—Ç-–≤–æ—Ç, –Ω–æ –Ω—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å—Å—è —Ç–µ—Ä–ø–µ–Ω–∏—è üòÖ\n\n‚ñ´Ô∏è –í—Ç–æ—Ä–æ–π –∏ —Ç—Ä–µ—Ç–∏–π –∫–æ—Ä–ø—É—Å–∞ —Å–ª–µ–¥—É—é—Ç –∑–∞ –ø–µ—Ä–≤–æ–ø—Ä–æ—Ö–æ–¥—Ü–µ–º —Å –Ω–µ–±–æ–ª—å—à–∏–º –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ–º ‚Äî –∫–∞–∫ –º–ª–∞–¥—à–∏–µ –±—Ä–∞—Ç—å—è, –∫–æ—Ç–æ—Ä—ã–µ —Å–ø–µ—à–∞—Ç –∑–∞ —Å—Ç–∞—Ä—à–∏–º.\n\n\n–ò —Ç—É—Ç —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ: –Ω–∞ —Ç—Ä–µ—Ç—å–µ–º —Å–∫–ª–∞–¥–µ –æ—Å—Ç–∞–ª–æ—Å—å –≤—Å–µ–≥–æ 2 –º–µ—Å—Ç–∞ –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ (11 –º–ª–Ω). \n\n–ó–Ω–∞–µ—Ç–µ, —á—Ç–æ —Å–∞–º–æ–µ –∑–∞–±–∞–≤–Ω–æ–µ? –≠—Ç–∏ —Å—á–∞—Å—Ç–ª–∏–≤—á–∏–∫–∏ –∑–∞–π–¥—É—Ç –≤ –ø—Ä–æ–µ–∫—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –±–µ–∑ —Ä–∏—Å–∫–æ–≤ –ø–æ —Å—Ä–æ–∫–∞–º —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ ‚Äî —Å–∫–ª–∞–¥ —É–∂–µ –ø–æ—á—Ç–∏ –≥–æ—Ç–æ–≤. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—Å—è, –≤—Å–µ —Å–ª–∏–≤–∫–∏ –¥–æ—Å—Ç–∞–Ω—É—Ç—Å—è —Ç–µ–º, –∫—Ç–æ –ø—Ä–∏—à—ë–ª –∫ –¥–µ—Å–µ—Ä—Ç—É üòâ\n\n–ß–µ—Å—Ç–Ω–æ –ø—Ä–∏–∑–Ω–∞—é—Å—å: –±—É–¥—å —É –º–µ–Ω—è —Å–µ–π—á–∞—Å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞, —Å–∞–º –±—ã –∑–∞–∫—Ä—ã–ª —ç—Ç–∏ 11 –º–ª–Ω –Ω–µ —Ä–∞–∑–¥—É–º—ã–≤–∞—è. –ù–æ, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—Å—è, —á—É–∂–æ–µ —Å—á–∞—Å—Ç—å–µ –∂–¥—ë—Ç —Å–≤–æ–µ–≥–æ –≥–µ—Ä–æ—è!\n\nüìå [–ü–æ—á–∏—Ç–∞—Ç—å –æ –ø—Ä–æ–µ–∫—Ç–µ]\nüìå [–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ö–æ–¥ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞]\nüìå [–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –∏ —Ñ–∏–Ω–º–æ–¥–µ–ª—å]\n\n–ê –≤—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –∑–∞—Ö–æ–¥–∏–ª–∏ –≤ –∏–Ω–≤–µ—Å—Ç–ø—Ä–æ–µ–∫—Ç –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–∞–¥–∏–∏?",
                        "caption_entities": [
                            {"length": 44, "offset": 3, "type": "bold"},
                            {
                                "length": 6,
                                "offset": 248,
                                "type": "text_link",
                                "url": "https://t.me/fryazino_redevest/67",
                            },
                            {
                                "length": 6,
                                "offset": 487,
                                "type": "text_link",
                                "url": "https://t.me/fryazino_redevest/63",
                            },
                            {
                                "length": 6,
                                "offset": 496,
                                "type": "text_link",
                                "url": "https://t.me/fryazino_redevest/64",
                            },
                            {"length": 64, "offset": 636, "type": "bold"},
                            {
                                "length": 18,
                                "offset": 1058,
                                "type": "text_link",
                                "url": "https://t.me/flipping_invest/807",
                            },
                            {
                                "length": 28,
                                "offset": 1082,
                                "type": "text_link",
                                "url": "https://t.me/fryazino_redevest",
                            },
                            {
                                "length": 34,
                                "offset": 1116,
                                "type": "text_link",
                                "url": "tg://resolve?domain=FlippingInvestBot&start=c1707842038691-ds",
                            },
                            {"length": 62, "offset": 1153, "type": "bold"},
                        ],
                        "chat": {
                            "id": -1001503592176,
                            "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å ‚Äî —á–∞—Ç",
                            "type": "supergroup",
                            "username": "redevest_chat",
                        },
                        "date": 1730178121,
                        "edit_date": 1730181661,
                        "forward_date": 1730178118,
                        "forward_from_chat": {
                            "id": -1001664173586,
                            "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Ä–µ–¥–µ–≤–µ–ª–æ–ø–º–µ–Ω—Ç | –õ–µ—â–µ–Ω–∫–æ",
                            "type": "channel",
                            "username": "flipping_invest",
                        },
                        "forward_from_message_id": 844,
                        "forward_origin": {
                            "chat": {
                                "id": -1001664173586,
                                "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Ä–µ–¥–µ–≤–µ–ª–æ–ø–º–µ–Ω—Ç | –õ–µ—â–µ–Ω–∫–æ",
                                "type": "channel",
                                "username": "flipping_invest",
                            },
                            "date": 1730178118,
                            "message_id": 844,
                            "type": "channel",
                        },
                        "from": {
                            "first_name": "Telegram",
                            "id": 777000,
                            "is_bot": False,
                        },
                        "is_automatic_forward": True,
                        "message_id": 10229,
                        "sender_chat": {
                            "id": -1001664173586,
                            "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Ä–µ–¥–µ–≤–µ–ª–æ–ø–º–µ–Ω—Ç | –õ–µ—â–µ–Ω–∫–æ",
                            "type": "channel",
                            "username": "flipping_invest",
                        },
                        "video": {
                            "duration": 95,
                            "file_id": "BAACAgIAAx0CWZ7-8AACJ_VnKASp23wG65v0zmT-JT2y3R9M1gACOFoAAl4LAUk6dPoMmYqiizYE",
                            "file_name": "–í–∏–¥–µ–æ WhatsApp 2024-10-26 –≤ 16.16.36_2bb4d36a.mp4",
                            "file_size": 11073514,
                            "file_unique_id": "AgADOFoAAl4LAUk",
                            "height": 480,
                            "mime_type": "video/mp4",
                            "thumb": {
                                "file_id": "AAMCAgADHQJZnv7wAAIn9WcoBKnbfAbrm_TOZP4lPbLdH0zWAAI4WgACXgsBSTp0-gyZiqKLAQAHbQADNgQ",
                                "file_size": 12103,
                                "file_unique_id": "AQADOFoAAl4LAUly",
                                "height": 180,
                                "width": 320,
                            },
                            "thumbnail": {
                                "file_id": "AAMCAgADHQJZnv7wAAIn9WcoBKnbfAbrm_TOZP4lPbLdH0zWAAI4WgACXgsBSTp0-gyZiqKLAQAHbQADNgQ",
                                "file_size": 12103,
                                "file_unique_id": "AQADOFoAAl4LAUly",
                                "height": 180,
                                "width": 320,
                            },
                            "width": 854,
                        },
                    },
                    "text": "–ê–ª–µ–∫—Å–µ–π, –¥–æ–±—Ä—ã–π –¥–µ–Ω—å!\n–ü–ª–∞–Ω–∏—Ä—É—é —Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ—ë –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –≤ –ú–û. –ù–æ –Ω–µ—Ç –≤ —ç—Ç–æ–º –æ–ø—ã—Ç–∞. –§–æ—Ä–º–∞—Ç —Å–∫–ª–∞–¥–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Å—Ç—Ä–æ–∏—Ç–µ, –∫–∞–∫ —Ä–∞–∑, —Ç–æ, —á—Ç–æ –º–Ω–µ –Ω—É–∂–Ω–æ. –ù–µ –º–æ–≥–ª–∏ –±—ã –í—ã –º–µ–Ω—è —Å–∫–æ–Ω—Ç–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –ü–∞–≤–ª–æ–º –ö—É–Ω—Ü–µ–≤—ã–º, –µ—Å–ª–∏ —è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª –æ–Ω –ø–æ–≥—Ä—É–∂–µ–Ω –≤ —ç—Ç—É —Ç–µ–º—É –∏ —Å–º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –∏ —Å–æ–≤–µ—Ç–æ–º –∏ –¥–µ–ª–æ–º.",
                },
                "update_id": 726062782,
            },
            True,
        ),
        (
            {
                "message": {
                    "chat": {
                        "id": -1001503592176,
                        "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å ‚Äî —á–∞—Ç",
                        "type": "supergroup",
                        "username": "redevest_chat",
                    },
                    "date": 1730714961,
                    "from": {
                        "first_name": "Master",
                        "id": 2058183096,
                        "is_bot": False,
                        "last_name": "Guru",
                        "username": "masterguru509",
                    },
                    "message_id": 10244,
                    "message_thread_id": 10229,
                    "reply_to_message": {
                        "caption": "üèó –ê–ø–¥–µ–π—Ç –ø–æ —Å–∫–ª–∞–¥–∞–º –≤–æ –§—Ä—è–∑–∏–Ω–æ: –¥–µ–ª–æ –∫ —Ñ–∏–Ω–∏—à—É!\n\n–î—Ä—É–∑—å—è, —Å–ø–µ—à—É –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–º–∏ –Ω–æ–≤–æ—Å—Ç—è–º–∏ —Å –Ω–∞—à–µ–π —Å—Ç—Ä–æ–π–ø–ª–æ—â–∞–¥–∫–∏!\n\n‚ñ´Ô∏è –ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –¥–æ–±—å—ë–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ñ–∏–ª—å–º –æ –ø—Ä–æ–µ–∫—Ç–µ (—Ç—Ä–µ–π–ª–µ—Ä –≤–≤–µ—Ä—Ö—É) ‚Äî –º–æ–Ω—Ç–∞–∂ —É–∂–µ –Ω–∞ —Ñ–∏–Ω–∏—à–Ω–æ–π –ø—Ä—è–º–æ–π. –ì–æ—Ç–æ–≤—å—Ç–µ –ø–æ–ø–∫–æ—Ä–Ω! üé¨\n\n‚ñ´Ô∏è –ü–µ—Ä–≤—ã–π —Å–∫–ª–∞–¥ —É–∂–µ –≥–æ—Ç–æ–≤ ‚Äî –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ–∂–¥–∞—Ç—å—Å—è, –ø–æ–∫–∞ –≤—ã—Å–æ—Ö–Ω–µ—Ç —Å–≤–µ–∂–µ–∑–∞–ª–∏—Ç—ã–π –ø–æ–ª, –∏ –º–æ–∂–Ω–æ –≤—ã—Ö–æ–¥–∏—Ç—å –Ω–∞ –∫–æ–º–∏—Å—Å–∏—é –ø–æ –≤–≤–æ–¥—É –≤ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é. –≠—Ç–æ –∫–∞–∫ –∂–¥–∞—Ç—å, –ø–æ–∫–∞ –æ—Å—Ç—ã–Ω–µ—Ç —Å–≤–µ–∂–µ–∏—Å–ø–µ—á–µ–Ω–Ω—ã–π –ø–∏—Ä–æ–≥ ‚Äî –∑–Ω–∞–µ—à—å, —á—Ç–æ –≤–æ—Ç-–≤–æ—Ç, –Ω–æ –Ω—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å—Å—è —Ç–µ—Ä–ø–µ–Ω–∏—è üòÖ\n\n‚ñ´Ô∏è –í—Ç–æ—Ä–æ–π –∏ —Ç—Ä–µ—Ç–∏–π –∫–æ—Ä–ø—É—Å–∞ —Å–ª–µ–¥—É—é—Ç –∑–∞ –ø–µ—Ä–≤–æ–ø—Ä–æ—Ö–æ–¥—Ü–µ–º —Å –Ω–µ–±–æ–ª—å—à–∏–º –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ–º ‚Äî –∫–∞–∫ –º–ª–∞–¥—à–∏–µ –±—Ä–∞—Ç—å—è, –∫–æ—Ç–æ—Ä—ã–µ —Å–ø–µ—à–∞—Ç –∑–∞ —Å—Ç–∞—Ä—à–∏–º.\n\n\n–ò —Ç—É—Ç —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ: –Ω–∞ —Ç—Ä–µ—Ç—å–µ–º —Å–∫–ª–∞–¥–µ –æ—Å—Ç–∞–ª–æ—Å—å –≤—Å–µ–≥–æ 2 –º–µ—Å—Ç–∞ –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ (11 –º–ª–Ω). \n\n–ó–Ω–∞–µ—Ç–µ, —á—Ç–æ —Å–∞–º–æ–µ –∑–∞–±–∞–≤–Ω–æ–µ? –≠—Ç–∏ —Å—á–∞—Å—Ç–ª–∏–≤—á–∏–∫–∏ –∑–∞–π–¥—É—Ç –≤ –ø—Ä–æ–µ–∫—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –±–µ–∑ —Ä–∏—Å–∫–æ–≤ –ø–æ —Å—Ä–æ–∫–∞–º —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ ‚Äî —Å–∫–ª–∞–¥ —É–∂–µ –ø–æ—á—Ç–∏ –≥–æ—Ç–æ–≤. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—Å—è, –≤—Å–µ —Å–ª–∏–≤–∫–∏ –¥–æ—Å—Ç–∞–Ω—É—Ç—Å—è —Ç–µ–º, –∫—Ç–æ –ø—Ä–∏—à—ë–ª –∫ –¥–µ—Å–µ—Ä—Ç—É üòâ\n\n–ß–µ—Å—Ç–Ω–æ –ø—Ä–∏–∑–Ω–∞—é—Å—å: –±—É–¥—å —É –º–µ–Ω—è —Å–µ–π—á–∞—Å —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞, —Å–∞–º –±—ã –∑–∞–∫—Ä—ã–ª —ç—Ç–∏ 11 –º–ª–Ω –Ω–µ —Ä–∞–∑–¥—É–º—ã–≤–∞—è. –ù–æ, –∫–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—Å—è, —á—É–∂–æ–µ —Å—á–∞—Å—Ç—å–µ –∂–¥—ë—Ç —Å–≤–æ–µ–≥–æ –≥–µ—Ä–æ—è!\n\nüìå [–ü–æ—á–∏—Ç–∞—Ç—å –æ –ø—Ä–æ–µ–∫—Ç–µ]\nüìå [–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ö–æ–¥ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞]\nüìå [–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –∏ —Ñ–∏–Ω–º–æ–¥–µ–ª—å]\n\n–ê –≤—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –∑–∞—Ö–æ–¥–∏–ª–∏ –≤ –∏–Ω–≤–µ—Å—Ç–ø—Ä–æ–µ–∫—Ç –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Å—Ç–∞–¥–∏–∏?",
                        "caption_entities": [
                            {"length": 44, "offset": 3, "type": "bold"},
                            {
                                "length": 6,
                                "offset": 248,
                                "type": "text_link",
                                "url": "https://t.me/fryazino_redevest/67",
                            },
                            {
                                "length": 6,
                                "offset": 487,
                                "type": "text_link",
                                "url": "https://t.me/fryazino_redevest/63",
                            },
                            {
                                "length": 6,
                                "offset": 496,
                                "type": "text_link",
                                "url": "https://t.me/fryazino_redevest/64",
                            },
                            {"length": 64, "offset": 636, "type": "bold"},
                            {
                                "length": 18,
                                "offset": 1058,
                                "type": "text_link",
                                "url": "https://t.me/flipping_invest/807",
                            },
                            {
                                "length": 28,
                                "offset": 1082,
                                "type": "text_link",
                                "url": "https://t.me/fryazino_redevest",
                            },
                            {
                                "length": 34,
                                "offset": 1116,
                                "type": "text_link",
                                "url": "tg://resolve?domain=FlippingInvestBot&start=c1707842038691-ds",
                            },
                            {"length": 62, "offset": 1153, "type": "bold"},
                        ],
                        "chat": {
                            "id": -1001503592176,
                            "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å ‚Äî —á–∞—Ç",
                            "type": "supergroup",
                            "username": "redevest_chat",
                        },
                        "date": 1730178121,
                        "edit_date": 1730181661,
                        "forward_date": 1730178118,
                        "forward_from_chat": {
                            "id": -1001664173586,
                            "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Ä–µ–¥–µ–≤–µ–ª–æ–ø–º–µ–Ω—Ç | –õ–µ—â–µ–Ω–∫–æ",
                            "type": "channel",
                            "username": "flipping_invest",
                        },
                        "forward_from_message_id": 844,
                        "forward_origin": {
                            "chat": {
                                "id": -1001664173586,
                                "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Ä–µ–¥–µ–≤–µ–ª–æ–ø–º–µ–Ω—Ç | –õ–µ—â–µ–Ω–∫–æ",
                                "type": "channel",
                                "username": "flipping_invest",
                            },
                            "date": 1730178118,
                            "message_id": 844,
                            "type": "channel",
                        },
                        "from": {
                            "first_name": "Telegram",
                            "id": 777000,
                            "is_bot": False,
                        },
                        "is_automatic_forward": True,
                        "message_id": 10229,
                        "sender_chat": {
                            "id": -1001664173586,
                            "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Ä–µ–¥–µ–≤–µ–ª–æ–ø–º–µ–Ω—Ç | –õ–µ—â–µ–Ω–∫–æ",
                            "type": "channel",
                            "username": "flipping_invest",
                        },
                        "video": {
                            "duration": 95,
                            "file_id": "BAACAgIAAx0CWZ7-8AACJ_VnKASp23wG65v0zmT-JT2y3R9M1gACOFoAAl4LAUk6dPoMmYqiizYE",
                            "file_name": "–í–∏–¥–µ–æ WhatsApp 2024-10-26 –≤ 16.16.36_2bb4d36a.mp4",
                            "file_size": 11073514,
                            "file_unique_id": "AgADOFoAAl4LAUk",
                            "height": 480,
                            "mime_type": "video/mp4",
                            "thumb": {
                                "file_id": "AAMCAgADHQJZnv7wAAIn9WcoBKnbfAbrm_TOZP4lPbLdH0zWAAI4WgACXgsBSTp0-gyZiqKLAQAHbQADNgQ",
                                "file_size": 12103,
                                "file_unique_id": "AQADOFoAAl4LAUly",
                                "height": 180,
                                "width": 320,
                            },
                            "thumbnail": {
                                "file_id": "AAMCAgADHQJZnv7wAAIn9WcoBKnbfAbrm_TOZP4lPbLdH0zWAAI4WgACXgsBSTp0-gyZiqKLAQAHbQADNgQ",
                                "file_size": 12103,
                                "file_unique_id": "AQADOFoAAl4LAUly",
                                "height": 180,
                                "width": 320,
                            },
                            "width": 854,
                        },
                    },
                    "text": "—Å–∫–æ–ª—å–∫–æ –∑–∞—Ä–∞–±–æ—Ç–∞—é—Ç –∏–Ω–≤–µ—Å—Ç–æ—Ä—ã –≥–æ–¥–æ–≤—ã—Ö?",
                },
                "update_id": 726062786,
            },
            True,
        ),
        (
            {
                "message": {
                    "chat": {
                        "id": -1001503592176,
                        "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å ‚Äî —á–∞—Ç",
                        "type": "supergroup",
                        "username": "redevest_chat",
                    },
                    "date": 1730714058,
                    "from": {
                        "first_name": "Channel",
                        "id": 136817688,
                        "is_bot": True,
                        "username": "Channel_Bot",
                    },
                    "message_id": 10243,
                    "message_thread_id": 10229,
                    "quote": {
                        "is_manual": True,
                        "position": 22,
                        "text": "–ü–ª–∞–Ω–∏—Ä—É—é —Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ—ë –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –≤ –ú–û",
                    },
                    "reply_to_message": {
                        "chat": {
                            "id": -1001503592176,
                            "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å ‚Äî —á–∞—Ç",
                            "type": "supergroup",
                            "username": "redevest_chat",
                        },
                        "date": 1730712821,
                        "from": {
                            "first_name": "Denis",
                            "id": 205980892,
                            "is_bot": False,
                            "username": "buloshnikov",
                        },
                        "message_id": 10242,
                        "message_thread_id": 10229,
                        "text": "–ê–ª–µ–∫—Å–µ–π, –¥–æ–±—Ä—ã–π –¥–µ–Ω—å!\n–ü–ª–∞–Ω–∏—Ä—É—é —Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ—ë –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –≤ –ú–û. –ù–æ –Ω–µ—Ç –≤ —ç—Ç–æ–º –æ–ø—ã—Ç–∞. –§–æ—Ä–º–∞—Ç —Å–∫–ª–∞–¥–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —Å—Ç—Ä–æ–∏—Ç–µ, –∫–∞–∫ —Ä–∞–∑, —Ç–æ, —á—Ç–æ –º–Ω–µ –Ω—É–∂–Ω–æ. –ù–µ –º–æ–≥–ª–∏ –±—ã –í—ã –º–µ–Ω—è —Å–∫–æ–Ω—Ç–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –ü–∞–≤–ª–æ–º –ö—É–Ω—Ü–µ–≤—ã–º, –µ—Å–ª–∏ —è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª –æ–Ω –ø–æ–≥—Ä—É–∂–µ–Ω –≤ —ç—Ç—É —Ç–µ–º—É –∏ —Å–º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –∏ —Å–æ–≤–µ—Ç–æ–º –∏ –¥–µ–ª–æ–º.",
                    },
                    "sender_chat": {
                        "id": -1001664173586,
                        "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Ä–µ–¥–µ–≤–µ–ª–æ–ø–º–µ–Ω—Ç | –õ–µ—â–µ–Ω–∫–æ",
                        "type": "channel",
                        "username": "flipping_invest",
                    },
                    "text": "–ê –ø–æ—á–µ–º—É —Å—Ç—Ä–æ–∏—Ç—å, –∞ –Ω–µ –∫—É–ø–∏—Ç—å –≥–æ—Ç–æ–≤–æ–µ?",
                },
                "update_id": 726062784,
            },
            False,
        ),
        (
            {
                "message": {
                    "chat": {
                        "id": -1001503592176,
                        "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å ‚Äî —á–∞—Ç",
                        "type": "supergroup",
                        "username": "redevest_chat",
                    },
                    "date": 1730715059,
                    "entities": [{"length": 61, "offset": 48, "type": "url"}],
                    "from": {
                        "first_name": "Channel",
                        "id": 136817688,
                        "is_bot": True,
                        "username": "Channel_Bot",
                    },
                    "message_id": 10246,
                    "message_thread_id": 10229,
                    "reply_to_message": {
                        "chat": {
                            "id": -1001503592176,
                            "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å ‚Äî —á–∞—Ç",
                            "type": "supergroup",
                            "username": "redevest_chat",
                        },
                        "date": 1730714961,
                        "from": {
                            "first_name": "Master",
                            "id": 2058183096,
                            "is_bot": False,
                            "last_name": "Guru",
                            "username": "masterguru509",
                        },
                        "message_id": 10244,
                        "message_thread_id": 10229,
                        "text": "—Å–∫–æ–ª—å–∫–æ –∑–∞—Ä–∞–±–æ—Ç–∞—é—Ç –∏–Ω–≤–µ—Å—Ç–æ—Ä—ã –≥–æ–¥–æ–≤—ã—Ö?",
                    },
                    "sender_chat": {
                        "id": -1001664173586,
                        "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ —Ä–µ–¥–µ–≤–µ–ª–æ–ø–º–µ–Ω—Ç | –õ–µ—â–µ–Ω–∫–æ",
                        "type": "channel",
                        "username": "flipping_invest",
                    },
                    "text": "–î–æ 70% –≥–æ–¥–æ–≤—ã—Ö.\n\n–ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–∞—è —Ñ–∏–Ω–º–æ–¥–µ–ª—å —Ç—É—Ç: tg://resolve?domain=FlippingInvestBot&start=c1707842038691-ds",
                },
                "update_id": 726062788,
            },
            False,
        ),
        (
            {
                "message": {
                    "chat": {
                        "id": -1001503592176,
                        "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å ‚Äî —á–∞—Ç",
                        "type": "supergroup",
                        "username": "redevest_chat",
                    },
                    "date": 1730721610,
                    "from": {
                        "first_name": "–°–µ—Ä–≥–µ–π",
                        "id": 589118505,
                        "is_bot": False,
                        "is_premium": True,
                        "language_code": "ru",
                        "last_name": "–ù–∞—Å–µ–¥–∫–∏–Ω",
                        "username": "Serg1VN",
                    },
                    "message_id": 10254,
                    "message_thread_id": 10229,
                    "reply_to_message": {
                        "chat": {
                            "id": -1001503592176,
                            "title": "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å ‚Äî —á–∞—Ç",
                            "type": "supergroup",
                            "username": "redevest_chat",
                        },
                        "date": 1730721393,
                        "from": {
                            "first_name": "Denis",
                            "id": 205980892,
                            "is_bot": False,
                            "username": "buloshnikov",
                        },
                        "message_id": 10252,
                        "message_thread_id": 10229,
                        "text": "–ü–ª–∞–Ω–∏—Ä—É—é —Å—Ç—Ä–æ–∏—Ç—å—Å—è –≤ –≥–æ—Ä–æ–¥—Å–∫–æ–º –æ–∫—Ä—É–≥–µ –ü–æ–¥–æ–ª—å—Å–∫ –∏–ª–∏ –î–æ–º–æ–¥–µ–¥–æ–≤–æ –¥–æ –¶–ö–ê–î. –ü–ª–æ—â–∞–¥—å 1500-2000–º.  –ü–æ –º–æ–µ–º—É –ø–æ–Ω–∏–º–∞–Ω–∏—é —Å—Ç—Ä–æ–∏—Ç—å—Å—è –±—É–¥–µ—Ç —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –≤—ã–≥–æ–¥–Ω–µ–µ —á–µ–º –ø–æ–∫—É–ø–∞—Ç—å –≥–æ—Ç–æ–≤–æ–µ, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –∏–¥—Ç–∏ —á–µ—Ä–µ–∑ –∞—Ä–µ–Ω–¥—É –ó–£, —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∏ –≤—ã–∫—É–ø.",
                    },
                    "text": "–ï—Å–ª–∏ –¥–æ —ç—Ç–æ–≥–æ –Ω–µ —Å—Ç—Ä–æ–∏–ª–∏—Å—å —Ç–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –º–æ–∂–µ—Ç –≤—ã–π—Ç–∏ –¥–æ—Ä–æ–≥–æ –∏ –¥–æ–ª–≥–æ.\n–ú–æ–∂–µ—Ç –ª—É—á—à–µ –ø—Ä–∏–≤–ª–µ—á—å –ø–∞—Ä—Ç–Ω—ë—Ä–∞  –∫—Ç–æ —É–∂–µ –∏–º–µ–µ—Ç –æ–ø—ã—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ö–æ–∂–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.",
                },
                "update_id": 726062795,
            },
            False,
        ),
    ],
)
async def test_single_update(update, should_process):
    # extract Message
    msg = Message.model_validate(update["message"])
    print(msg)
    assert await filter_handle_message(msg) == should_process
